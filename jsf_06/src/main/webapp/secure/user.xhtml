<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core">
<h:head><title>Kadromierz - secure</title></h:head>
<h:body>
  <h1>Kadromierz (część chroniona)</h1>

  <p>Zalogowany: <b>#{authBean.username}</b> (#{authBean.role})</p>
  <p><a href="#{request.contextPath}/logout">Wyloguj</a></p>

  <hr/>

  <h2>Wybierz użytkownika (GET: parametr userId)</h2>
  <h:dataTable value="#{kadromierzBean.users}" var="u" border="1">
    <h:column><f:facet name="header">ID</f:facet>#{u.id}</h:column>
    <h:column><f:facet name="header">Username</f:facet>#{u.username}</h:column>
    <h:column><f:facet name="header">Role</f:facet>#{u.role}</h:column>
    <h:column>
      <f:facet name="header">Akcja</f:facet>
      <h:link value="Pokaż" outcome="selectUser.xhtml">
        <f:param name="userId" value="#{u.id}"/>
      </h:link>
    </h:column>
  </h:dataTable>

  <hr/>

  <h2>Wybrany użytkownik (stan w sesji)</h2>
  <h:panelGroup rendered="#{not empty kadromierzBean.selectedUser}">
    <p><b>ID:</b> #{kadromierzBean.selectedUser.id}</p>
    <p><b>Username:</b> #{kadromierzBean.selectedUser.username}</p>
    <p><b>Role:</b> #{kadromierzBean.selectedUser.role}</p>
  </h:panelGroup>

  <h:panelGroup rendered="#{empty kadromierzBean.selectedUser}">
    <p>Nie wybrano użytkownika.</p>
  </h:panelGroup>

  <hr/>

  <h2>Grafik (kolekcja z DB)</h2>
  <h:dataTable value="#{kadromierzBean.schedules}" var="s" border="1">
    <h:column><f:facet name="header">Data</f:facet>#{s.shiftDate}</h:column>
    <h:column><f:facet name="header">Start</f:facet>#{s.shiftStart}</h:column>
    <h:column><f:facet name="header">Koniec</f:facet>#{s.shiftEnd}</h:column>
  </h:dataTable>

  <h3>Dodaj wpis do grafiku (POST)</h3>
  <h:form method="post">
    <p>Data (YYYY-MM-DD): <h:inputText value="#{kadromierzBean.newSchedule.shiftDate}"/></p>
    <p>Start (HH:MM): <h:inputText value="#{kadromierzBean.newSchedule.shiftStart}"/></p>
    <p>Koniec (HH:MM): <h:inputText value="#{kadromierzBean.newSchedule.shiftEnd}"/></p>
    <h:commandButton value="Dodaj" action="#{kadromierzBean.addSchedule}"/>
  </h:form>

  <hr/>

  <h2>Zmiany (shifts)</h2>
  <h:form>
    <h:commandButton value="Start zmiany (POST)" action="#{kadromierzBean.startShift}"/>
  </h:form>

  <h:dataTable value="#{kadromierzBean.shifts}" var="sh" border="1">
    <h:column><f:facet name="header">ID</f:facet>#{sh.id}</h:column>
    <h:column><f:facet name="header">Start</f:facet>#{sh.startTime}</h:column>
    <h:column><f:facet name="header">Koniec</f:facet>#{sh.endTime}</h:column>
    <h:column>
      <f:facet name="header">Akcja</f:facet>
      <h:form rendered="#{empty sh.endTime}">
        <h:commandButton value="Zakończ" action="#{kadromierzBean.endShift(sh.id)}"/>
      </h:form>
    </h:column>
  </h:dataTable>

</h:body>
</html>
